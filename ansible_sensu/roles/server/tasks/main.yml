# server/tasks/main.yml
---
- name: Template over redis config
  template: src=redis.json.j2 dest=/etc/sensu/conf.d/redis.json
  notify: restart redis

- name: Template over sensu api config
  template: src=api.json.j2 dest=/etc/sensu/conf.d/api.json
  notify: restart sensu server services
    
- name: Template checks
  template: src=checks.json.j2 dest=/etc/sensu/conf.d/checks.json
  notify: restart sensu server services
  
- name: Disk usage metrics
  template: src=disk-usage-metrics.json.j2 dest=/etc/sensu/conf.d/disk-usage-metrics.json
  notify: restart sensu server services

- name: Disk usage metrics
  template: src=load-metrics.json.j2 dest=/etc/sensu/conf.d/load-metrics.json
  notify: restart sensu server services


- name: Disk usage metrics
  template: src=interface-metrics.json.j2 dest=/etc/sensu/conf.d/interface-metrics.json
  notify: restart sensu server services

- name: Ensure state of server services
  service: name={{ item }} state=started enabled=yes
  with_items:
    - sensu-server
    - sensu-api
    - redis-server
